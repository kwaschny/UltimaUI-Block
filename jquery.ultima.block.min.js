// MIT, Copyright (c) 2014-2017 Alexander Kwaschny, kwaschny.net
if(!window.UltimaBlock){if(jQuery===undefined){throw new Error("jQuery missing for UltimaBlock")}if(!jQuery.isPlainObject){throw new Error("jQuery 1.4+ required for UltimaBlock")}window.UltimaBlock=function(e,t){if(!(this instanceof UltimaBlock)){return new UltimaBlock(t)}e=jQuery(e);var s=0,o=UltimaBlock.collection.length;for(s;s<o;s++){if(e[0]===UltimaBlock.collection[s].target[0]){var n=UltimaBlock.collection[s];n.options.current=n._.methods.mergeOptions(n.options.current,t);return n}}this._={};var i=this;this.target=e;this.overlay=null;this.message=null;this.options={};this.options.current={};this.options["default"]={message:"",behavior:{zIndexInc:true},css:{overlay:{className:"",zIndex:9001},message:{className:"",offset:{x:0,y:0},viewport:"auto",x:"50%",y:"50%"}},callbacks:{onBlocking:undefined,onUnblocking:undefined}};this._.properties={classNames:{overlay:"UltimaBlock-overlay",message:"UltimaBlock-message"}};this.block=function(e){if(jQuery.isFunction(this.options.current.callbacks.onBlocking)){if(this.options.current.callbacks.onBlocking(this)===false){return false}}if(this.overlay===null||!document.body.contains(this.overlay.dom.element[0])){this.overlay=this._.methods.createOverlay();this.target.css({position:"relative"});this.target.append(this.overlay.dom.element)}if(this.message===null||!document.body.contains(this.message.dom.outerElement[0])){this.message=this._.methods.createMessage();this.overlay.dom.element.append(this.message.dom.outerElement)}this.message.set(e);this.overlay.show();this.message.show()};this.unblock=function(){if(jQuery.isFunction(this.options.current.callbacks.onUnblocking)){if(this.options.current.callbacks.onUnblocking(this)===false){return false}}if(this.overlay===null){return false}this.overlay.hide()};this._.methods={createOverlay:function(){var e={dom:{element:jQuery("<div></div>").hide()},hide:function(){this.dom.element.hide()},show:function(){this.dom.element.show();this._.methods.reposition()},_:{methods:{reposition:function(){var e,t;if(typeof i.options.current.css.message.viewport.width==="number"){e=i.options.current.css.message.viewport.width}else{e=i.overlay.dom.element.outerWidth()}if(typeof i.options.current.css.message.viewport.height==="number"){t=i.options.current.css.message.viewport.height}else{t=i.overlay.dom.element.outerHeight()}var s=i.message.dom.innerElement.width();var o=i.message.dom.innerElement.height();var n,r;if(/^[0-9]{1,3}%$/.test(i.options.current.css.message.x)){n=i.options.current.css.message.x.replace("%","")*e/100-s/2}else{n=i.options.current.css.message.x}if(/^[0-9]{1,3}%$/.test(i.options.current.css.message.y)){r=i.options.current.css.message.y.replace("%","")*t/100-o/2}else{r=i.options.current.css.message.y}i.message.dom.innerElement.css({left:n+i.options.current.css.message.offset.x,top:r+i.options.current.css.message.offset.y})}}}};e.dom.element.addClass(i._.properties.classNames.overlay);e.dom.element.addClass(i.options.current.css.overlay.className);var t={};if(!i.options.current.css.overlay.className){t.backgroundColor="rgba(0, 0, 0, 0.50)"}jQuery.extend(true,t,i.options.current.css.overlay);jQuery.extend(true,t,{bottom:0,height:"100%",left:0,margin:0,position:"absolute",right:0,top:0,width:"100%",zIndex:i.options.current.css.overlay.zIndex+(i.options.current.behavior.zIndexInc?UltimaBlock.collection.length:0)});e.dom.element.css(t);return e},createMessage:function(){var e={dom:{outerElement:jQuery("<div></div>"),innerElement:jQuery("<div></div>")},hide:function(){this.dom.outerElement.hide()},set:function(e){this.dom.innerElement.html(e)},show:function(){this.dom.outerElement.show()}};e.dom.innerElement.addClass(i._.properties.classNames.message);e.dom.innerElement.addClass(i.options.current.css.message.className);e.dom.outerElement.css({height:"100%",position:"relative",width:"100%"});var t={};if(!i.options.current.css.message.className){t.color="#FFFFFF"}jQuery.extend(true,t,i.options.current.css.message);jQuery.extend(true,t,{position:"absolute"});e.dom.innerElement.css(t);e.dom.outerElement.append(e.dom.innerElement);return e},mergeOptions:function(e,t){i._.methods.translateOptions(t);var s={};jQuery.extend(true,s,e);jQuery.extend(true,s,t);return s},translateOptions:function(e){var t,s,o,n,i;for(var r in e){if(!e.hasOwnProperty(r)){continue}if(r.indexOf("->")!==0){continue}t=r.replace("->","");t=t.split(".");s=t.length;n={};i=n;for(o=0;o<s-1;o++){i[t[o]]={};i=i[t[o]]}i[t[s-1]]=e[r];delete e[r];jQuery.extend(true,e,n)}return e}};this.options.current=this._.methods.mergeOptions(this.options["default"],UltimaBlock.options);this.options.current=this._.methods.mergeOptions(this.options.current,t);UltimaBlock.collection.push(this)};UltimaBlock.collection=[];UltimaBlock.options={};jQuery.UltimaBlock={options:{}};jQuery.UltimaBlock.block=function(e,t){var s={};jQuery.extend(true,s,jQuery.UltimaBlock.options);jQuery.extend(true,s,t);var o=new UltimaBlock(e,s);o.block();return o};jQuery.UltimaBlock.unblock=function(e,t){var s={};jQuery.extend(true,s,jQuery.UltimaBlock.options);jQuery.extend(true,s,t);var o=new UltimaBlock(e,s);o.unblock();return o};jQuery.fn.block=function(e,t){if(t===undefined){if(typeof e!=="string"){t=e}}var s={};jQuery.extend(true,s,jQuery.UltimaBlock.options);jQuery.extend(true,s,t);this.each(function(){new UltimaBlock(this,s).block(e)});return this};jQuery.fn.unblock=function(e){var t={};jQuery.extend(true,t,jQuery.UltimaBlock.options);jQuery.extend(true,t,e);this.each(function(){new UltimaBlock(this,t).unblock()});return this};UltimaBlock.version="0.3.5"}